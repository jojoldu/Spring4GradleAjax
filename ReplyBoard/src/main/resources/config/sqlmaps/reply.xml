<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="zum.potal.dwlee.dao.ReplyDao"><!-- namespace에서 interface로 정의된 DAO를 정확히 명시해주어야 한다 -->
  
  <resultMap type="zum.potal.dwlee.vo.ReplyVO" id="replyVO">
  	<result property="no" column="no"/>
  	<result property="content" column="content"/>
  	<result property="writeDate" column="write_date"/>
	<result property="writer" column="writer"/>
	<result property="family" column="family"/>
	<result property="parent" column="parent"/>
	<result property="depth" column="depth"/>
  </resultMap>
  
  <select id="getList" resultMap="replyVO">
	SELECT 
			A.*
	FROM
	        (SELECT *
			   FROM reply
		   ORDER BY family DESC ,  depth ASC) A
	LIMIT #{firstRow}, #{pageSize}
  </select>
  
  <select id="getPagingInfo" parameterType="zum.potal.dwlee.vo.CommonVO" resultType="int" >
  	SELECT count(no)
  	  FROM reply
  </select>
  
  <insert id="add" parameterType="zum.potal.dwlee.vo.ReplyVO" ><!-- parameterType를 권장  -->
	INSERT 
	  INTO 	reply 
	  		(content,write_date,writer,family,parent,depth,imageName) 
	VALUES	(#{content},NOW(),#{writer},#{family},#{parent},#{depth}, #{imageName})
  </insert>
  
  <select id="getNo" resultType="int">
 	SELECT MAX(no) 
 	  FROM reply
  </select>
  
  <select id="getParent" parameterType="int" resultMap="replyVO">
 	SELECT * 
 	  FROM reply
 	 WHERE no = #{no}  
  </select>
  
  <delete id="delete" parameterType="zum.potal.dwlee.vo.ReplyVO">
  	DELETE
  	  FROM reply
  	 WHERE no = #{no}
  </delete>

  
</mapper>